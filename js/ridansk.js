!function($){$.fn.waterTank=function(options){var settings=$.extend({color:"#6ecff6",level:33},options);function _updateTank(t,e){t.find("._tank").fadeIn(1),t.find("._balance").stop().animate({height:t.find("._tank").height()*(100-e)/100},{duration:speed,step:function(){t.find("._balance").css("overflow","visible")},complete:function(){t.find("._balance").css("overflow","visible")}}),t.find("._filled").stop().animate({height:t.find("._tank").height()*e/100,opacity:1},{duration:speed,step:function(){t.find("._filled").css("overflow","visible")},complete:function(){t.find("._filled").css("overflow","visible")}}),t.find("._percentageTag").text(e+"%"),t.find("._reflect").stop().animate({height:t.find("._tank").height()*e/100/2+20,bottom:-t.find("._tank").height()*e/100/2-20},speed),100==e?t.find("._topCircle").hide(0):t.find("._topCircle").show(0)}var tilt={"-webkit-transform":"rotateX(65deg) translateZ(0px)","-moz-transform":"rotateX(65deg) translateZ(0px)","-o-transform":"rotateX(65deg) translateZ(0px)",transform:"rotateX(65deg) translateZ(0px)","-moz-transform-style":"preserve-3d","-webkit-transform-style":"preserve-3d","transform-style":"preserve-3d"},speed=1500;if(options%1==0)_updateTank($(this),options);else{if($(this).is(":empty")){var $tank=$("<div/>").appendTo(this);$tank.css({width:settings.width,height:settings.height,position:"relative",margin:settings.height/2+"px auto",transform:"translate3d(0,0,0)"}).addClass("_tank");var $balance=$("<div/>").appendTo($tank);$balance.css({height:settings.height,background:"#f2f2f1",position:"relative",transform:"translateZ(0px)"}).addClass("_balance");var $balanceTopCircle=$("<div/>").appendTo($balance);$balanceTopCircle.css(Object.assign({height:settings.width,width:"100%",background:"#f2f2f1",borderRadius:"50%",top:0,marginTop:-settings.width/2,position:"absolute"},tilt));var $topCircle=$("<div/>").appendTo($tank);$topCircle.css(Object.assign({height:settings.width,width:"100%",background:"rgba(255, 255, 255, .2)",borderRadius:"50%",top:0,marginTop:-settings.width/2,position:"absolute",zIndex:500,pointerEvents:"none"},tilt)).addClass("_topCircle");var $filled=$("<div/>").appendTo($tank);$filled.css({height:0,position:"relative",opacity:0,transform:"translate3d(0,0,0)"}).addClass("_filled");var $filledBg=$("<div/>").appendTo($filled);$filledBg.css(Object.assign({height:"100%",width:"100%",background:settings.color,position:"absolute",opacity:.8,zIndex:10}));var $percentageTag=$("<div><div/>").appendTo($filledBg);$percentageTag.css(Object.assign({position:"absolute",right:-85,width:70,fontSize:17,top:-10,textAlign:"left"})).addClass("_percentageTag").text(settings.level+"%");var $filledTopCircle=$("<div/>").appendTo($filled);$filledTopCircle.css(Object.assign({height:settings.width,width:"100%",background:settings.color,borderRadius:"50%",top:0,marginTop:-settings.width/2,position:"absolute",overflow:"hidden",zIndex:10},tilt));var $canvas=$("<canvas/>").appendTo($filledTopCircle);if($canvas.css({opacity:.8,transform:"rotate(80deg)"}),$canvas){var canvas=$canvas.get(0),ctx=canvas.getContext("2d"),width=settings.width,height=settings.width,half_width=width>>1,half_height=height>>1,size=width*(height+2)*2,delay=30,oldind=width,newind=width*(height+3),riprad=8,ripplemap=[],last_map=[],ripple,texture,line_width=1,step=18*line_width,count=height/line_width;with(canvas.width=width,canvas.height=height,ctx){fillStyle=settings.color,fillRect(0,0,width,height),fillStyle="#000",save(),rotate(-.785);for(var i=0;i<count;i++)fillRect(-width,i*step,3*width,line_width);restore()}texture=ctx.getImageData(0,0,width,height),ripple=ctx.getImageData(0,0,width,height);for(var i=0;i<size;i++)last_map[i]=ripplemap[i]=0;function run(){newframe(),ctx.putImageData(ripple,0,0)}function disturb(t,e){t<<=0;for(var i=(e<<=0)-riprad;i<e+riprad;i++)for(var a=t-riprad;a<t+riprad;a++)ripplemap[oldind+i*width+a]+=128}function newframe(){var t,e,i,a,n,s,d=oldind;oldind=newind,newind=d;for(var o=0,r=width,l=height,h=ripplemap,p=last_map,c=ripple.data,g=texture.data,f=half_width,v=half_height,$=0;$<l;$++)for(var w=0;w<r;w++){var b=newind+o,u=oldind+o;i=h[u-r]+h[u+r]+h[u-1]+h[u+1]>>1,i-=h[b],i-=i>>5,h[b]=i,i=1024-i,s=p[o],p[o]=i,s!=i&&(e=(($-v)*i/1024<<0)+v,(t=((w-f)*i/1024<<0)+f)>=r&&(t=r-1),t<0&&(t=0),e>=l&&(e=l-1),e<0&&(e=0),n=4*(t+e*r),c[a=4*o]=g[n],c[a+1]=g[n+1],c[a+2]=g[n+2]),++o}}if(canvas.onmousemove=function(t){disturb(t.offsetX||t.layerX,t.offsetY||t.layerY)},settings.level>=0){setInterval(run,delay);var rnd=Math.random;setInterval(function(){disturb(rnd()*width,rnd()*height)},700)}}var $filledBottomCircle=$("<div/>").appendTo($filled);$filledBottomCircle.css(Object.assign({height:settings.width,width:"100%",background:settings.color,borderRadius:"50%",bottom:0,marginBottom:-settings.width/2,position:"absolute",boxShadow:"rgba(0, 0, 0, 0.3) 0px 15px 50px"},tilt));var $reflect=$("<div/>").appendTo($filled);$reflect.addClass("_reflect"),$reflect.css("background","-moz-linear-gradient(top, "+settings.color+") 0%, rgba(255,255,255,0) 100%)"),$reflect.css("background","-webkit-linear-gradient(top, "+settings.color+" 0%,rgba(255,255,255,0) 100%)"),$reflect.css("background","linear-gradient(to bottom, "+settings.color+" 0%,rgba(255,255,255,0) 100%)"),$reflect.css({position:"absolute",width:"100%",height:settings.height*(100-settings.level)/100,opacity:.4})}else var $tank=$(this).find("_tank"),$balance=$(this).find("_balance"),$filled=$(this).find("_filled");$tank.fadeOut(0);var _this=$(this);setTimeout(function(){_updateTank(_this,settings.level)},300)}return this}}(jQuery);